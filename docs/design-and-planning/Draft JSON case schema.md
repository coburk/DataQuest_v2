## üìù JSON Case Schema for DataQuest

The following schema defines the structure for a **CasePlan** generated by the **Case Planner Agent (US-07)** and used for validation by the  **SQL Enforcer (US-08)** . This schema ensures that every investigative case is logically sound, fully solvable, and provides the necessary components for the  **Query Tutor Agent (US-05/US-06)** .

This structure maps directly to the **High-Level Entity Relationship Diagram** and the system's focus on evidence, statements, and relationships.

---

**JSON**

```
{
  "title": "DataQuest Case Schema",
  "type": "object",
  "properties": {
    "CaseID": {
      "type": "string",
      "description": "Unique identifier for the case (e.g., 'CASE_001')."
    },
    "CaseTitle": {
      "type": "string",
      "description": "The narrative title of the investigation (e.g., 'The Missing Server Log')."
    },
    "InitialPrompt": {
      "type": "string",
      "description": "The introductory narrative text presented to the student to set the scene and state the initial goal."
    },
    "Conclusion": {
      "type": "string",
      "description": "The solution narrative provided upon successful completion of the final step."
    },
    "IsSolvable": {
      "type": "boolean",
      "description": "Confirmed by the SQL Enforcer and Case Planner: true if all StorySteps can be resolved by running canonical SQL."
    },
    "DatabaseLocation": {
      "type": "string",
      "description": "The name of the database where the case data resides (e.g., 'DataQuestDB')."
    },
    "Persons": {
      "type": "array",
      "description": "List of key individuals involved in the case (suspects, witnesses, victims).",
      "items": {
        "type": "object",
        "properties": {
          "PersonID": {"type": "integer"},
          "Name": {"type": "string"},
          "Role": {"type": "string", "description": "e.g., 'Suspect', 'Victim', 'Witness'."}
        },
        "required": ["PersonID", "Name", "Role"]
      }
    },
    "StorySteps": {
      "type": "array",
      "description": "The sequential investigative steps the student must complete to solve the case.",
      "items": {
        "type": "object",
        "properties": {
          "StepID": {
            "type": "integer",
            "description": "The order of the step (1, 2, 3, etc.)."
          },
          "StepPrompt": {
            "type": "string",
            "description": "The narrative instruction for the student's current task (i.e., 'Find the log entry where the suspect logged in')."
          },
          "EvidenceType": {
            "type": "string",
            "description": "The type of data the student must find (e.g., 'LOG_ENTRY', 'TRANSACTION_ID', 'LOCATION_ID')."
          },
          "CanonicalQuery": {
            "type": "string",
            "description": "The SQL query that produces the correct result set for this step. Used by the Query Tutor Agent."
          },
          "RequiredAnswerField": {
            "type": "string",
            "description": "The specific column name in the canonical result set that holds the final clue (e.g., 'person_name')."
          },
          "ExpectedValue": {
            "type": "string",
            "description": "The specific value expected in the RequiredAnswerField. Used by the SQL Enforcer for validation."
          },
          "ErrorContext": {
            "type": "string",
            "description": "Optional: Contextual information for the Tutor Agent to generate specific hints if the student fails (e.g., 'Hint 1 focuses on the correct JOIN table')."
          }
        },
        "required": [
          "StepID",
          "StepPrompt",
          "CanonicalQuery",
          "RequiredAnswerField",
          "ExpectedValue"
        ]
      }
    },
    "Contradictions": {
      "type": "array",
      "description": "List of known logical inconsistencies, used by the SQL Enforcer for validation. (e.g., a witness statement contradicts a log time).",
      "items": {
        "type": "object",
        "properties": {
          "ContradictionID": {"type": "integer"},
          "Type": {"type": "string"},
          "Details": {"type": "string"}
        },
        "required": ["ContradictionID", "Details"]
      }
    }
  },
  "required": [
    "CaseID",
    "CaseTitle",
    "InitialPrompt",
    "Conclusion",
    "IsSolvable",
    "StorySteps"
  ]
}
```

### Key Schema Elements and Agent Interaction

| **Element**            | **Relevant Agent(s)** | **Role in the System**                                                                                                                                          |
| ---------------------------- | --------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **`StorySteps`**     | Case Planner, Query Tutor   | The core sequence of the investigation. The Case Planner generates these, and the Query Tutor uses the structure to guide feedback.                                   |
| **`CanonicalQuery`** | Case Planner, Query Tutor   | The verified correct SQL used by the Tutor Agent (US-05b) to run the**Expected Result**against which the student's output is compared.                          |
| **`IsSolvable`**     | SQL Enforcer                | A flag set only after the Enforcer validates that running all `CanonicalQuery`values produces the required `ExpectedValue`s, ensuring the case is not a dead end. |
| **`ErrorContext`**   | Query Tutor                 | Optional data used for the AI to generate more relevant and Socratic hints, ensuring the hints are grounded in the specific pedagogical challenge of the step.        |
