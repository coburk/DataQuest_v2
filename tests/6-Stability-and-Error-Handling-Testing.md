## Detailed Test Plan: DataQuest: SQL Detective

### 6. Stability and Error Handling Testing

This evaluation area focuses on deliberately attempting to crash the application and introduce broken logic to verify that the system is robust. The goal is to ensure that when errors occur—whether due to user input, AI failure, or environmental issues—the application maintains stability, provides clear feedback, and preserves the learning experience.

#### A. SQL and Input Error Resilience

| **ID**      | **Test Case / Procedure**                                                                                                                                    | **Expected Result / Success Criteria**                                                                                                                                                                        | **Pass/Fail** |
| ----------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------- |
| **SET-001** | **Invalid SQL Syntax:**Student submits a query that is structurally incorrect (e.g.,`SLEECT * FROM Persons WHERE...`).                                           | The database returns a syntax error. The application gracefully captures the error and displays a clear, non-technical error message to the student. No application crash occurs.                                   | [ ]                 |
| **SET-002** | **Infinite Loop/Timeout:**Submit a query designed to be extremely inefficient or cause a long lock (e.g., a massive `CROSS JOIN`).                               | The**MCP Client**respects the configured `AITimeouts:InferenceTimeoutSeconds`and terminates the query after the timeout limit, displaying an error message about execution exceeding time limits.           | [ ]                 |
| **SET-003** | **Unsafe Statement Execution (Boundary Test):**Attempt to bypass the**Query Validator (US-03f)**by obfuscating an unsafe command (e.g.,`SELEC'T; UPDATE`). | The**Query Validator**detects the unsafe intent and blocks the query. If a simple bypass is missed, the `sql.execute_readonly`tool on the**MCP Server**must ultimately prevent any data modification. | [ ]                 |
| **SET-004** | **Query Returning Empty Set:**Submit a query that is syntactically correct but returns zero rows when it should return one or more.                                | The**Query Tutor**correctly identifies the output as a mismatch against the canonical result (which expects at least one row). The system flags the result as "Incorrect" but remains stable.                 | [ ]                 |

#### B. Agent and Infrastructure Failure Resilience

| **ID**      | **Test Case / Procedure**                                                                                                                          | **Expected Result / Success Criteria**                                                                                                                                                                 | **Pass/Fail** |
| ----------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------- |
| **SET-005** | **LLM Service Offline:**Shut down the local**Ollama**service, then attempt to generate a hint (triggering **Phase 2** ).               | The**Ollama Interface**handles the connection refusal error. A clear error message is displayed to the student stating the AI service is unavailable. The application does not crash.                  | [ ]                 |
| **SET-006** | **Missing Case Files:**Manually delete a `CasePlan.json`file from the Case Storage Directory.                                                          | The**Case Registry Handler**successfully scans the directory, skips the missing file, and the application loads the registry without crashing. The missing case does not appear in the selection list. | [ ]                 |
| **SET-007** | **Malformed Case File:**Manually edit a `CasePlan.json`to be structurally invalid (e.g., missing closing brace, invalid JSON structure).               | The**JSON Import Service**catches the `JsonException`during deserialization. The case is rejected, a FATAL/ERROR log entry is recorded, and the application remains operational.                     | [ ]                 |
| **SET-008** | **Contradictory/Unsolvable Case Load:**Attempt to load a case where the**SQL Enforcer**failed the solvability check (`IsSolvable: false`). | The**Case Loading Pipeline**detects `IsSolvable: false`in Stage II, terminates the loading process, and displays an error message explaining the case is broken.                                     | [ ]                 |
